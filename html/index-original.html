<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connection Information - mccarville.com</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .container { 
            max-width: 800px; 
            background: white; 
            padding: 40px; 
            border-radius: 15px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        h1 { 
            color: #333; 
            text-align: center; 
            margin-bottom: 30px; 
            font-size: 2em;
            font-weight: 400;
        }
        .status { 
            text-align: center; 
            background: #4CAF50; 
            color: white; 
            padding: 15px; 
            border-radius: 10px;
            margin: 20px 0; 
            font-size: 1.1em;
        }
        .info-section { 
            margin: 20px 0; 
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid #eee;
        }
        .info-title { 
            font-weight: bold; 
            color: white;
            background: #667eea;
            padding: 15px 20px; 
            margin: 0;
            font-size: 1.1em;
        }
        .info-content { 
            background: #f8f9fa; 
            padding: 20px; 
            font-family: 'Courier New', monospace; 
            white-space: pre-line;
        }
        .footer {
            text-align: center; 
            margin-top: 20px; 
            color: #666;
            font-size: 0.9em;
        }
        .warning {
            background: #ff9800;
            color: white;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-size: 0.9em;
        }
    </style>
    <script>
        function updateConnectionInfo() {
            var info = {
                userAgent: navigator.userAgent,
                language: navigator.language,
                platform: navigator.platform,
                cookieEnabled: navigator.cookieEnabled,
                onLine: navigator.onLine,
                screen: screen.width + "x" + screen.height,
                timestamp: new Date().toISOString(),
                url: window.location.href,
                referrer: document.referrer || "Direct access"
            };
            
            document.getElementById("client-ip").innerHTML = "Detecting...";
            document.getElementById("browser-info").innerHTML = 
                "User Agent: " + info.userAgent + "\n" +
                "Language: " + info.language + "\n" +
                "Platform: " + info.platform + "\n" +
                "Screen: " + info.screen + "\n" +
                "Cookies Enabled: " + info.cookieEnabled + "\n" +
                "Online: " + info.onLine;
            
            document.getElementById("page-info").innerHTML = 
                "Current URL: " + info.url + "\n" +
                "Referrer: " + info.referrer + "\n" +
                "Timestamp: " + info.timestamp;
            
            // Update client-side visible headers
            updateClientHeaders();
            
            // Try to get server-side headers
            updateServerHeaders();
            
            // Try to get IP from external service
            fetch("https://api.ipify.org?format=json")
                .then(response => response.json())
                .then(data => {
                    document.getElementById("client-ip").innerHTML = data.ip;
                })
                .catch(error => {
                    document.getElementById("client-ip").innerHTML = "Unable to detect (External API blocked)";
                });
        }
        
        function updateClientHeaders() {
            // Client-side can only see limited header information
            var clientHeaders = {
                "Accept": "Limited client-side visibility",
                "Accept-Language": navigator.language,
                "User-Agent": navigator.userAgent,
                "Referrer": document.referrer || "Direct access"
            };
            
            var headerText = "";
            for (var key in clientHeaders) {
                headerText += key + ": " + clientHeaders[key] + "\n";
            }
            headerText += "\n⚠️  Limited client-side view. For complete headers, server-side implementation needed.";
            
            document.getElementById("client-headers").innerHTML = headerText;
        }
        
        function updateServerHeaders() {
            // Try to fetch headers from a server endpoint
            fetch('/api/headers.php')
                .then(response => response.json())
                .then(data => {
                    var headerText = "=== HTTP HEADERS ===\n";
                    for (var key in data.headers) {
                        headerText += key + ": " + data.headers[key] + "\n";
                    }
                    
                    headerText += "\n=== SERVER INFORMATION ===\n";
                    for (var key in data.server_info) {
                        headerText += key + ": " + data.server_info[key] + "\n";
                    }
                    
                    headerText += "\nLast Updated: " + data.timestamp;
                    document.getElementById("server-headers").innerHTML = headerText;
                })
                .catch(error => {
                    document.getElementById("server-headers").innerHTML = 
                        "Server endpoint not available.\n\n" +
                        "To see complete HTTP headers, you need to:\n" +
                        "1. Upload headers.php to your web server\n" +
                        "2. Ensure PHP is enabled on your server\n" +
                        "3. The script will capture all HTTP headers\n\n" +
                        "Error: " + error.message;
                });
        }
        
        // Debug logging
        console.log('JavaScript loaded successfully');
        
        // Multiple event listeners to ensure execution
        window.onload = function() {
            console.log('Window onload triggered');
            updateConnectionInfo();
        };
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMContentLoaded triggered');
            updateConnectionInfo();
        });
        
        // Fallback timeout
        setTimeout(function() {
            console.log('Fallback timeout triggered');
            updateConnectionInfo();
        }, 1000);
        
        setInterval(updateConnectionInfo, 30000);
    </script>
</head>
<body>
    <div class="container">
        <h1>&#x1F310; Connection Information Display</h1>
        <div class="status">&#x2705; HTTPS Site is Working! SSL/TLS Certificate Active</div>
        
        <div class="info-section">
            <div class="info-title">&#x1F50D; Your IP Address</div>
            <div class="info-content" id="client-ip">Loading...</div>
        </div>
        
        <div class="info-section">
            <div class="info-title">&#x1F310; Browser Information</div>
            <div class="info-content" id="browser-info">Loading...</div>
        </div>
        
        <div class="info-section">
            <div class="info-title">&#x1F4C4; Page Information</div>
            <div class="info-content" id="page-info">Loading...</div>
        </div>
        
        <div class="info-section">
            <div class="info-title">&#x1F4E1; HTTP Headers (Client-Side View)</div>
            <div class="info-content" id="client-headers">Loading...</div>
        </div>
        
        <div class="info-section">
            <div class="info-title">&#x1F4E1; HTTP Headers (Server-Side View)</div>
            <div class="info-content" id="server-headers">Loading...</div>
        </div>
        
        <div class="footer">
            &#x1F504; Auto-refreshes every 30 seconds
        </div>
    </div>
</body>
</html>
