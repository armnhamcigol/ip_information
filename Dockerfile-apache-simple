FROM php:8.0-apache

# Create symlinks for enabled modules manually
RUN ln -sf /etc/apache2/mods-available/ssl.load /etc/apache2/mods-enabled/ \
    && ln -sf /etc/apache2/mods-available/ssl.conf /etc/apache2/mods-enabled/ \
    && ln -sf /etc/apache2/mods-available/rewrite.load /etc/apache2/mods-enabled/ \
    && ln -sf /etc/apache2/mods-available/headers.load /etc/apache2/mods-enabled/ \
    && ln -sf /etc/apache2/mods-available/socache_shmcb.load /etc/apache2/mods-enabled/

# Copy configuration files
COPY apache-config.conf /etc/apache2/sites-available/000-default.conf
COPY apache-ssl.conf /etc/apache2/sites-available/default-ssl.conf

# Enable SSL site by creating symlink
RUN ln -sf /etc/apache2/sites-available/default-ssl.conf /etc/apache2/sites-enabled/

# Expose ports
EXPOSE 80 443

# Start Apache in foreground
CMD ["apache2-foreground"]
