<IfModule mod_ssl.c>
    <VirtualHost _default_:443>
        ServerAdmin admin@mccarville.com
        DocumentRoot /var/www/html

        # SSL Configuration
        SSLEngine on
        SSLCertificateFile /etc/letsencrypt/live/mccarville.com/fullchain.pem
        SSLCertificateKeyFile /etc/letsencrypt/live/mccarville.com/privkey.pem

        # SSL Security
        SSLProtocol all -SSLv2 -SSLv3 -TLSv1 -TLSv1.1
        SSLCipherSuite ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384
        SSLHonorCipherOrder off
        SSLSessionTickets off

        # Security Headers
        Header always set Strict-Transport-Security "max-age=63072000"
        Header always set X-Frame-Options DENY
        Header always set X-Content-Type-Options nosniff
        Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' https://api.ipify.org; style-src 'self' 'unsafe-inline'; connect-src 'self' https://api.ipify.org;"

        # PHP Configuration
        <Directory /var/www/html>
            AllowOverride All
            Require all granted
            DirectoryIndex index.html index.php
        </Directory>

        # Certbot challenge
        Alias /.well-known/acme-challenge/ /var/www/certbot/.well-known/acme-challenge/
        <Directory /var/www/certbot>
            AllowOverride None
            Require all granted
        </Directory>

        ErrorLog ${APACHE_LOG_DIR}/ssl_error.log
        CustomLog ${APACHE_LOG_DIR}/ssl_access.log combined
    </VirtualHost>
</IfModule>
